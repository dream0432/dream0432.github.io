<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ให้เราได้รับฟังและให้คุณได้ระบาย</title>
  <style>
    body {
      font-family: "Kanit", sans-serif;
      background: linear-gradient(to bottom right, #f0f4f8, #dbeafe);
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
      justify-content: center;
      align-items: center;
    }

    #app {
      background: white;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.05);
      border-radius: 10px;
      max-width: 400px;
      width: 90vw;
      font-size: 14px;
      box-sizing: border-box;
      position: relative;
    }

    h1 {
      font-size: 18px;
      margin-bottom: 16px;
      text-align: center;
      color: #1e293b;
    }

    button {
      background-color: #3b82f6;
      color: white;
      padding: 10px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin: 6px 0;
      width: 100%;
      box-sizing: border-box;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #2563eb;
    }

    textarea#paper {
      background: #fff8dc;
      border: 2px solid #deb887;
      border-radius: 8px;
      padding: 12px;
      width: 100%;
      height: 150px;
      resize: none;
      font-size: 14px;
      color: #5a3e1b;
      transition: all 1.5s ease;
      box-sizing: border-box;
      position: relative;
      z-index: 2;
    }

    .burning {
      animation: burn-text 2s forwards;
    }

    @keyframes burn-text {
      0% { color: #5a3e1b; background-color: #fff8dc; opacity: 1; }
      50% { color: #ff4500; background-color: #fbbf24; opacity: 0.5; }
      100% { color: transparent; background-color: black; opacity: 0; }
    }

    #new-btn {
      margin-top: 10px;
      display: none;
    }

    #encourage-text {
      margin-top: 10px;
      font-size: 12px;
      color: #555;
      text-align: center;
      display: none;
      user-select: none;
    }

    #admin-login {
      display: none;
      margin-top: 12px;
    }

    #admin-login input {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #cbd5e1;
      font-size: 13px;
      background-color: #f1f5f9;
      margin-bottom: 6px;
      box-sizing: border-box;
    }

    .error {
      color: red;
      font-size: 12px;
      text-align: center;
    }

    #history {
      background: #f3f4f6;
      padding: 10px;
      border-radius: 6px;
      margin-top: 16px;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      display: none;
    }

    .entry {
      border-bottom: 1px solid #ccc;
      padding-bottom: 6px;
      margin-bottom: 6px;
      white-space: pre-wrap;
    }

    #ash-container {
      position: absolute;
      top: 70px;
      left: 0;
      width: 100%;
      height: 150px;
      pointer-events: none;
      overflow: visible;
      z-index: 1;
    }

    .ash {
      position: absolute;
      width: 6px;
      height: 6px;
      background: #555;
      opacity: 0.8;
      border-radius: 50%;
      animation-name: ash-fall;
      animation-duration: 2s;
      animation-timing-function: ease-out;
      animation-fill-mode: forwards;
    }

    @keyframes ash-fall {
      0% {
        transform: translateY(0) scale(1);
        opacity: 0.8;
      }
      100% {
        transform: translateY(-50px) translateX(10px) scale(0.1);
        opacity: 0;
      }
    }

    @media (max-width: 500px) {
      #app {
        padding: 16px;
        font-size: 13px;
      }
      button {
        font-size: 13px;
        padding: 8px;
      }
      textarea#paper {
        font-size: 13px;
        height: 140px;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="welcome-page">
      <h1>ให้เราได้รับฟังและให้คุณได้ระบาย</h1>
      <button id="guest-btn">ระบายเลย</button>
      <button id="admin-show-btn">เข้าสู่ระบบแอดมิน</button>
      <div id="admin-login">
        <input type="password" id="admin-pass" placeholder="รหัสแอดมิน" autocomplete="off" />
        <div id="admin-error" class="error"></div>
        <button id="admin-login-btn">เข้าสู่ระบบ</button>
      </div>
    </div>

    <div id="page2" style="display:none;">
      <textarea id="paper" placeholder="พิมพ์ข้อความระบายที่นี่..."></textarea>
      <div id="ash-container"></div>
      <button id="burn-btn">เผาไหม้</button>
      <button id="new-btn">ระบายใหม่</button>
      <div id="encourage-text">ขอให้คุณรักตัวเองและการที่คุณเศร้าจะมีเราอยู่ข้างเสมอนะ</div>
    </div>

    <div id="history">
      <strong>ประวัติข้อความ:</strong>
      <div id="entries"></div>
    </div>
  </div>

  <script>
    const guestBtn = document.getElementById("guest-btn");
    const adminShowBtn = document.getElementById("admin-show-btn");
    const adminLoginBox = document.getElementById("admin-login");
    const adminPass = document.getElementById("admin-pass");
    const adminLoginBtn = document.getElementById("admin-login-btn");
    const adminError = document.getElementById("admin-error");
    const welcomePage = document.getElementById("welcome-page");
    const page2 = document.getElementById("page2");
    const paper = document.getElementById("paper");
    const burnBtn = document.getElementById("burn-btn");
    const newBtn = document.getElementById("new-btn");
    const encourageText = document.getElementById("encourage-text");
    const historyBox = document.getElementById("history");
    const entriesDiv = document.getElementById("entries");
    const ashContainer = document.getElementById("ash-container");

    let isAdmin = false;

    guestBtn.addEventListener("click", () => {
      isAdmin = false;
      showPage2();
    });

    adminShowBtn.addEventListener("click", () => {
      adminLoginBox.style.display = "block";
    });

    adminLoginBtn.addEventListener("click", () => {
      if (adminPass.value === "230749") {
        isAdmin = true;
        adminError.textContent = "";
        adminPass.value = "";
        showPage2();
        showHistory();
      } else {
        adminError.textContent = "รหัสแอดมินไม่ถูกต้อง";
      }
    });

    function showPage2() {
      welcomePage.style.display = "none";
      page2.style.display = "block";
      historyBox.style.display = isAdmin ? "block" : "none";
      resetPaper();
    }

    function resetPaper() {
      paper.value = "";
      paper.classList.remove("burning");
      paper.style.opacity = "1";
      burnBtn.style.display = "block";
      newBtn.style.display = "none";
      encourageText.style.display = "none";
      ashContainer.innerHTML = "";
    }

    function saveEntry(text) {
      let entries = JSON.parse(localStorage.getItem("entries")) || [];
      entries.push({ text: text, time: new Date().toLocaleString() });
      localStorage.setItem("entries", JSON.stringify(entries));
    }

    function showHistory() {
      let entries = JSON.parse(localStorage.getItem("entries")) || [];
      entriesDiv.innerHTML = "";
      entries.slice().reverse().forEach(entry => {
        const div = document.createElement("div");
        div.className = "entry";
        div.textContent = `[${entry.time}] ${entry.text}`;
        entriesDiv.appendChild(div);
      });
    }

    function createAshParticles() {
      ashContainer.innerHTML = ""; // ล้างเก่าออกก่อน
      for(let i=0; i<20; i++) {
        const ash = document.createElement("div");
        ash.classList.add("ash");
        ash.style.left = (Math.random() * 95) + "%";
        ash.style.top = (Math.random() * 140) + "px";
        ash.style.animationDelay = (i * 100) + "ms";
        ashContainer.appendChild(ash);
      }
    }

    burnBtn.addEventListener("click", () => {
      const text = paper.value.trim();
      if (text) {
        if (!isAdmin) saveEntry(text);
        paper.classList.add("burning");
        createAshParticles();
        burnBtn.style.display = "none";
        setTimeout(() => {
          paper.value = "";
          paper.style.opacity = "0";
          ashContainer.innerHTML = "";
          newBtn.style.display = "block";
          encourageText.style.display = "block";
          if (isAdmin) showHistory();
        }, 2000);
      }
    });

    newBtn.addEventListener("click", () => {
      resetPaper();
    });
  </script>
</body>
</html>
